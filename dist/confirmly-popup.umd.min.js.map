{"version":3,"file":"confirmly-popup.umd.min.js","sources":["../src/confirmlyPopup.ts"],"sourcesContent":["import {\n  createPopper,\n  Instance as PopperInstance,\n  Placement,\n} from '@popperjs/core';\nimport { PopperOptions } from './constants';\n\nimport '../styles/confirmly-popup.scss';\n\nexport class ConfirmPopup {\n  private popperInstance: PopperInstance | null = null;\n  private readonly template: string;\n  private readonly buttonClasses: { confirm: string; cancel: string };\n  private readonly buttonContents: { confirm: string; cancel: string };\n  private readonly defaultPlacement: Placement;\n  private readonly popperElement: HTMLElement;\n  private onConfirmCallback?: () => void;\n  private onCancelCallback?: () => void;\n  private readonly showError: boolean;\n\n  constructor({\n    template,\n    buttonClasses = {\n      confirm: 'confirmly__button confirmly__button--confirm',\n      cancel: 'confirmly__button confirmly__button--cancel',\n    },\n    buttonContents = { confirm: 'Yes', cancel: 'No' },\n    defaultPlacement = 'top',\n    targetElement,\n    onConfirm,\n    onCancel,\n    showError = true,\n  }: PopperOptions) {\n    this.template = template || this.defaultTemplate();\n    this.buttonClasses = buttonClasses;\n    this.buttonContents = buttonContents;\n    this.defaultPlacement = defaultPlacement;\n    this.showError = showError;\n\n    this.popperElement = this.createPopperElement();\n    document.body.appendChild(this.popperElement);\n\n    if (targetElement) {\n      this.attach(targetElement, onConfirm, onCancel);\n    } else if (this.showError) {\n      console.error('Target Element is not defined');\n    }\n  }\n\n  private defaultTemplate(): string {\n    return `\n      <div class=\"confirmly__popup\">\n        <div class=\"confirmly__content\">\n          <p class=\"confirmly__message\">Are you sure?</p>\n          <div class=\"confirmly__buttons\">\n            <button class=\"{{cancelClass}}\" data-button=\"cancel\">{{cancelContent}}</button>\n            <button class=\"{{confirmClass}}\" data-button=\"confirm\">{{confirmContent}}</button>\n          </div>\n        </div>\n        <div class=\"confirmly__arrow\" data-popper-arrow></div>\n      </div>\n    `;\n  }\n\n  private createPopperElement(): HTMLElement {\n    const popperDiv = document.createElement('div');\n    popperDiv.className = 'confirmly';\n    popperDiv.style.display = 'none';\n\n    const template = this.template\n      .replace('{{confirmClass}}', this.buttonClasses.confirm)\n      .replace('{{cancelClass}}', this.buttonClasses.cancel)\n      .replace('{{confirmContent}}', this.buttonContents.confirm)\n      .replace('{{cancelContent}}', this.buttonContents.cancel);\n\n    popperDiv.innerHTML = template;\n    this.attachButtonListeners(popperDiv);\n\n    return popperDiv;\n  }\n\n  private attachButtonListeners(popperDiv: HTMLElement): void {\n    const confirmButton = popperDiv.querySelector('[data-button=\"confirm\"]');\n    const cancelButton = popperDiv.querySelector('[data-button=\"cancel\"]');\n\n    if (confirmButton) {\n      confirmButton.addEventListener('click', this.handleConfirm.bind(this));\n    }\n\n    if (cancelButton) {\n      cancelButton.addEventListener('click', this.handleCancel.bind(this));\n    }\n  }\n\n  public attach(\n    element: HTMLElement,\n    onConfirm?: () => void,\n    onCancel?: () => void,\n  ): void {\n    if (!element && this.showError) {\n      console.error('Target Element is not defined');\n      return;\n    }\n\n    this.onConfirmCallback = onConfirm;\n    this.onCancelCallback = onCancel;\n\n    element?.addEventListener('click', (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      this.showPopper(element);\n    });\n\n    document.addEventListener('click', this.handleOutsideClick.bind(this));\n    document.addEventListener('keydown', this.handleEscapeKey.bind(this));\n  }\n\n  public destroy(): void {\n    if (this.popperInstance) {\n      this.popperInstance.destroy();\n      this.popperInstance = null;\n    }\n    this.popperElement.remove();\n    document.removeEventListener('click', this.handleOutsideClick.bind(this));\n    document.removeEventListener('keydown', this.handleEscapeKey.bind(this));\n  }\n\n  private handleOutsideClick(event: MouseEvent): void {\n    if (!this.popperElement.contains(event.target as Node)) {\n      this.hidePopper();\n    }\n  }\n\n  private handleEscapeKey(event: KeyboardEvent): void {\n    if (event.key === 'Escape') {\n      this.hidePopper();\n    }\n  }\n\n  private showPopper(targetElement: HTMLElement) {\n    this.popperElement.style.display = 'block';\n    const popup = this.popperElement.querySelector('.confirmly__popup');\n\n    if (popup) {\n      requestAnimationFrame(() => {\n        popup.classList.add('confirmly__popup--visible');\n      });\n    }\n\n    if (this.popperInstance) {\n      this.popperInstance.destroy();\n    }\n\n    this.popperInstance = createPopper(targetElement, this.popperElement, {\n      placement: this.defaultPlacement,\n      modifiers: [\n        {\n          name: 'offset',\n          options: {\n            offset: [0, 8],\n          },\n        },\n        {\n          name: 'arrow',\n          options: {\n            element: '[data-popper-arrow]',\n            padding: 8,\n          },\n        },\n        {\n          name: 'preventOverflow',\n          options: {\n            padding: 8,\n            boundary: 'viewport',\n          },\n        },\n      ],\n    });\n  }\n\n  private hidePopper(): void {\n    const popup = this.popperElement.querySelector('.confirmly__popup');\n\n    if (popup) {\n      popup.classList.remove('confirmly__popup--visible');\n      setTimeout(() => {\n        if (this.popperInstance) {\n          this.popperInstance.destroy();\n          this.popperInstance = null;\n        }\n        this.popperElement.style.display = 'none';\n      }, 200);\n    }\n  }\n\n  private handleConfirm(): void {\n    this.onConfirmCallback?.();\n    this.hidePopper();\n  }\n\n  private handleCancel(): void {\n    this.onCancelCallback?.();\n    this.hidePopper();\n  }\n}\n"],"names":["ConfirmPopup","_a","template","_b","buttonClasses","undefined","confirm","cancel","_c","buttonContents","_d","defaultPlacement","targetElement","onConfirm","onCancel","_e","showError","this","popperInstance","defaultTemplate","popperElement","createPopperElement","document","body","appendChild","attach","console","error","prototype","popperDiv","createElement","className","style","display","replace","innerHTML","attachButtonListeners","confirmButton","querySelector","cancelButton","addEventListener","handleConfirm","bind","handleCancel","element","_this","onConfirmCallback","onCancelCallback","event","preventDefault","stopPropagation","showPopper","handleOutsideClick","handleEscapeKey","destroy","remove","removeEventListener","contains","target","hidePopper","key","popup","requestAnimationFrame","classList","add","createPopper","placement","modifiers","name","options","offset","padding","boundary","setTimeout","call"],"mappings":"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"}