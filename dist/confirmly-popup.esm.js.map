{"version":3,"file":"confirmly-popup.esm.js","sources":["../src/confirmlyPopup.ts"],"sourcesContent":["import {\n  createPopper,\n  Instance as PopperInstance,\n  Placement,\n} from '@popperjs/core';\nimport { PopperOptions } from './constants';\n\nexport class ConfirmPopup {\n  private popperInstance: PopperInstance | null = null;\n  private readonly template: string;\n  private readonly buttonClasses: { confirm: string; cancel: string };\n  private readonly buttonContents: { confirm: string; cancel: string };\n  private readonly defaultPlacement: Placement;\n  private readonly popperElement: HTMLElement;\n  private onConfirmCallback?: () => void;\n  private onCancelCallback?: () => void;\n  private readonly showError: boolean;\n\n  constructor({\n    template,\n    buttonClasses = {\n      confirm: 'confirmly__button confirmly__button--confirm',\n      cancel: 'confirmly__button confirmly__button--cancel',\n    },\n    buttonContents = { confirm: 'Yes', cancel: 'No' },\n    defaultPlacement = 'top',\n    targetElement,\n    onConfirm,\n    onCancel,\n    showError = true,\n  }: PopperOptions) {\n    this.template = template || this.defaultTemplate();\n    this.buttonClasses = buttonClasses;\n    this.buttonContents = buttonContents;\n    this.defaultPlacement = defaultPlacement;\n    this.showError = showError;\n\n    this.popperElement = this.createPopperElement();\n    document.body.appendChild(this.popperElement);\n\n    if (targetElement) {\n      this.attach(targetElement, onConfirm, onCancel);\n    } else if (this.showError) {\n      console.error('Target Element is not defined');\n    }\n  }\n\n  private defaultTemplate(): string {\n    return `\n      <div class=\"confirmly__popup\">\n        <div class=\"confirmly__content\">\n          <p class=\"confirmly__message\">Are you sure?</p>\n          <div class=\"confirmly__buttons\">\n            <button class=\"{{cancelClass}}\" data-button=\"cancel\">{{cancelContent}}</button>\n            <button class=\"{{confirmClass}}\" data-button=\"confirm\">{{confirmContent}}</button>\n          </div>\n        </div>\n        <div class=\"confirmly__arrow\" data-popper-arrow></div>\n      </div>\n    `;\n  }\n\n  private createPopperElement(): HTMLElement {\n    const popperDiv = document.createElement('div');\n    popperDiv.className = 'confirmly';\n    popperDiv.style.display = 'none';\n\n    const template = this.template\n      .replace('{{confirmClass}}', this.buttonClasses.confirm)\n      .replace('{{cancelClass}}', this.buttonClasses.cancel)\n      .replace('{{confirmContent}}', this.buttonContents.confirm)\n      .replace('{{cancelContent}}', this.buttonContents.cancel);\n\n    popperDiv.innerHTML = template;\n    this.attachButtonListeners(popperDiv);\n\n    return popperDiv;\n  }\n\n  private attachButtonListeners(popperDiv: HTMLElement): void {\n    const confirmButton = popperDiv.querySelector('[data-button=\"confirm\"]');\n    const cancelButton = popperDiv.querySelector('[data-button=\"cancel\"]');\n\n    if (confirmButton) {\n      confirmButton.addEventListener('click', this.handleConfirm.bind(this));\n    }\n\n    if (cancelButton) {\n      cancelButton.addEventListener('click', this.handleCancel.bind(this));\n    }\n  }\n\n  public attach(\n    element: HTMLElement,\n    onConfirm?: () => void,\n    onCancel?: () => void,\n  ): void {\n    if (!element && this.showError) {\n      console.error('Target Element is not defined');\n      return;\n    }\n\n    this.onConfirmCallback = onConfirm;\n    this.onCancelCallback = onCancel;\n\n    element?.addEventListener('click', (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      this.showPopper(element);\n    });\n\n    document.addEventListener('click', this.handleOutsideClick.bind(this));\n    document.addEventListener('keydown', this.handleEscapeKey.bind(this));\n  }\n\n  public destroy(): void {\n    if (this.popperInstance) {\n      this.popperInstance.destroy();\n      this.popperInstance = null;\n    }\n    this.popperElement.remove();\n    document.removeEventListener('click', this.handleOutsideClick.bind(this));\n    document.removeEventListener('keydown', this.handleEscapeKey.bind(this));\n  }\n\n  private handleOutsideClick(event: MouseEvent): void {\n    if (!this.popperElement.contains(event.target as Node)) {\n      this.hidePopper();\n    }\n  }\n\n  private handleEscapeKey(event: KeyboardEvent): void {\n    if (event.key === 'Escape') {\n      this.hidePopper();\n    }\n  }\n\n  private showPopper(targetElement: HTMLElement) {\n    this.popperElement.style.display = 'block';\n    const popup = this.popperElement.querySelector('.confirmly__popup');\n\n    if (popup) {\n      requestAnimationFrame(() => {\n        popup.classList.add('confirmly__popup--visible');\n      });\n    }\n\n    if (this.popperInstance) {\n      this.popperInstance.destroy();\n    }\n\n    this.popperInstance = createPopper(targetElement, this.popperElement, {\n      placement: this.defaultPlacement,\n      modifiers: [\n        {\n          name: 'offset',\n          options: {\n            offset: [0, 8],\n          },\n        },\n        {\n          name: 'arrow',\n          options: {\n            element: '[data-popper-arrow]',\n            padding: 8,\n          },\n        },\n        {\n          name: 'preventOverflow',\n          options: {\n            padding: 8,\n            boundary: 'viewport',\n          },\n        },\n      ],\n    });\n  }\n\n  private hidePopper(): void {\n    const popup = this.popperElement.querySelector('.confirmly__popup');\n\n    if (popup) {\n      popup.classList.remove('confirmly__popup--visible');\n      setTimeout(() => {\n        if (this.popperInstance) {\n          this.popperInstance.destroy();\n          this.popperInstance = null;\n        }\n        this.popperElement.style.display = 'none';\n      }, 200);\n    }\n  }\n\n  private handleConfirm(): void {\n    this.onConfirmCallback?.();\n    this.hidePopper();\n  }\n\n  private handleCancel(): void {\n    this.onCancelCallback?.();\n    this.hidePopper();\n  }\n}\n"],"names":[],"mappings":"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"}