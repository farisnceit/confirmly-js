{"version":3,"file":"confirmly-popup.umd.js","sources":["../src/confirmlyPopup.ts"],"sourcesContent":["import {\n  createPopper,\n  Instance as PopperInstance,\n  Placement,\n} from '@popperjs/core';\nimport { PopperOptions } from './constants';\n\nexport class ConfirmPopup {\n  private popperInstance: PopperInstance | null = null;\n  private readonly template: string;\n  private readonly buttonClasses: { confirm: string; cancel: string };\n  private readonly buttonContents: { confirm: string; cancel: string };\n  private readonly defaultPlacement: Placement;\n  private readonly popperElement: HTMLElement;\n  private onConfirmCallback?: () => void;\n  private onCancelCallback?: () => void;\n  private readonly showError: boolean;\n\n  constructor({\n    template,\n    buttonClasses = {\n      confirm: 'confirmly__button confirmly__button--confirm',\n      cancel: 'confirmly__button confirmly__button--cancel',\n    },\n    buttonContents = { confirm: 'Yes', cancel: 'No' },\n    defaultPlacement = 'top',\n    targetElement,\n    onConfirm,\n    onCancel,\n    showError = true,\n  }: PopperOptions) {\n    this.template = template || this.defaultTemplate();\n    this.buttonClasses = buttonClasses;\n    this.buttonContents = buttonContents;\n    this.defaultPlacement = defaultPlacement;\n    this.showError = showError;\n\n    this.popperElement = this.createPopperElement();\n    document.body.appendChild(this.popperElement);\n\n    if (targetElement) {\n      this.attach(targetElement, onConfirm, onCancel);\n    } else if (this.showError) {\n      console.error('Target Element is not defined');\n    }\n  }\n\n  private defaultTemplate(): string {\n    return `\n      <div class=\"confirmly__popup\">\n        <div class=\"confirmly__content\">\n          <p class=\"confirmly__message\">Are you sure?</p>\n          <div class=\"confirmly__buttons\">\n            <button class=\"{{cancelClass}}\" data-button=\"cancel\">{{cancelContent}}</button>\n            <button class=\"{{confirmClass}}\" data-button=\"confirm\">{{confirmContent}}</button>\n          </div>\n        </div>\n        <div class=\"confirmly__arrow\" data-popper-arrow></div>\n      </div>\n    `;\n  }\n\n  private createPopperElement(): HTMLElement {\n    const popperDiv = document.createElement('div');\n    popperDiv.className = 'confirmly';\n    popperDiv.style.display = 'none';\n\n    const template = this.template\n      .replace('{{confirmClass}}', this.buttonClasses.confirm)\n      .replace('{{cancelClass}}', this.buttonClasses.cancel)\n      .replace('{{confirmContent}}', this.buttonContents.confirm)\n      .replace('{{cancelContent}}', this.buttonContents.cancel);\n\n    popperDiv.innerHTML = template;\n    this.attachButtonListeners(popperDiv);\n\n    return popperDiv;\n  }\n\n  private attachButtonListeners(popperDiv: HTMLElement): void {\n    const confirmButton = popperDiv.querySelector('[data-button=\"confirm\"]');\n    const cancelButton = popperDiv.querySelector('[data-button=\"cancel\"]');\n\n    if (confirmButton) {\n      confirmButton.addEventListener('click', this.handleConfirm.bind(this));\n    }\n\n    if (cancelButton) {\n      cancelButton.addEventListener('click', this.handleCancel.bind(this));\n    }\n  }\n\n  public attach(\n    element: HTMLElement,\n    onConfirm?: () => void,\n    onCancel?: () => void,\n  ): void {\n    if (!element && this.showError) {\n      console.error('Target Element is not defined');\n      return;\n    }\n\n    this.onConfirmCallback = onConfirm;\n    this.onCancelCallback = onCancel;\n\n    element?.addEventListener('click', (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      this.showPopper(element);\n    });\n\n    document.addEventListener('click', this.handleOutsideClick.bind(this));\n    document.addEventListener('keydown', this.handleEscapeKey.bind(this));\n  }\n\n  public destroy(): void {\n    if (this.popperInstance) {\n      this.popperInstance.destroy();\n      this.popperInstance = null;\n    }\n    this.popperElement.remove();\n    document.removeEventListener('click', this.handleOutsideClick.bind(this));\n    document.removeEventListener('keydown', this.handleEscapeKey.bind(this));\n  }\n\n  private handleOutsideClick(event: MouseEvent): void {\n    if (!this.popperElement.contains(event.target as Node)) {\n      this.hidePopper();\n    }\n  }\n\n  private handleEscapeKey(event: KeyboardEvent): void {\n    if (event.key === 'Escape') {\n      this.hidePopper();\n    }\n  }\n\n  private showPopper(targetElement: HTMLElement) {\n    this.popperElement.style.display = 'block';\n    const popup = this.popperElement.querySelector('.confirmly__popup');\n\n    if (popup) {\n      requestAnimationFrame(() => {\n        popup.classList.add('confirmly__popup--visible');\n      });\n    }\n\n    if (this.popperInstance) {\n      this.popperInstance.destroy();\n    }\n\n    this.popperInstance = createPopper(targetElement, this.popperElement, {\n      placement: this.defaultPlacement,\n      modifiers: [\n        {\n          name: 'offset',\n          options: {\n            offset: [0, 8],\n          },\n        },\n        {\n          name: 'arrow',\n          options: {\n            element: '[data-popper-arrow]',\n            padding: 8,\n          },\n        },\n        {\n          name: 'preventOverflow',\n          options: {\n            padding: 8,\n            boundary: 'viewport',\n          },\n        },\n      ],\n    });\n  }\n\n  private hidePopper(): void {\n    const popup = this.popperElement.querySelector('.confirmly__popup');\n\n    if (popup) {\n      popup.classList.remove('confirmly__popup--visible');\n      setTimeout(() => {\n        if (this.popperInstance) {\n          this.popperInstance.destroy();\n          this.popperInstance = null;\n        }\n        this.popperElement.style.display = 'none';\n      }, 200);\n    }\n  }\n\n  private handleConfirm(): void {\n    this.onConfirmCallback?.();\n    this.hidePopper();\n  }\n\n  private handleCancel(): void {\n    this.onCancelCallback?.();\n    this.hidePopper();\n  }\n}\n"],"names":["createPopper"],"mappings":"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"}